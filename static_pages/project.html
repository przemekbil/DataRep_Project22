<!DOCTYPE html>
<html lang="eng">
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <title>Project for 2022 Data Representation course</title>
        <link rel="stylesheet" type="text/css" href="css/style.css"/>
    </head>
    <body>
        <h1>2022 DATA REPRESENTATION Project</h1>
        <h1>Search Artist on Musixmatch.com</h1>
        <form id="search_artist">
          <label for="query">Search:</label>
          <input type="text" id="query" name="query">
          <button type="submit">Search</button>
        </form>
        <div id="search_results"></div>        
        <script>      
            // Search for artists
            const form = document.getElementById('search_artist');
            form.addEventListener('submit', async (event) => {
              event.preventDefault();
              const formData = new FormData(form);
              const query = formData.get('query');
              $.ajax(
                {
                    "url":`api/mm/find.artist/${query}`,
                    "method":"GET",
                    "data":"",
                    "dataType": "JSON",
                    "contentType": "application/json; charset=utf-8",
                    "success":function(result){   
                        //console.log(result)                         
                        const searchResults = document.getElementById('search_results');
                        searchResults.innerHTML = 'Artists matching your query: </br>';
                        // loop over results to list each artist found
                        for (const artist of result) {
                            var div = document.createElement('div');
                            div.setAttribute('class', 'artist');
                            div.setAttribute('id', artist.artist_id);
                            div.innerHTML = artist.artist_Name;
                            div.addEventListener('click', async (event)=>{
                                $.ajax(
                                    {
                                        "url":`api/mm/show.artist.albums/${artist.artist_id}`,
                                        "method":"GET",
                                        "data":"",
                                        "dataType": "JSON",
                                        "contentType": "application/json; charset=utf-8",
                                        "success":function(result){
                                            console.log(result)
                                        },
                                        "error":function(xhr, status, error){
                                            console.log("error: "+status+" msg: "+ error);
                                        }
                                    }
                                )
                            }

                            )
                            searchResults.appendChild(div);                            
                        }//end of for artist loop

                    },
                    "error":function(xhr, status, error){
                        console.log("error: "+status+" msg: "+ error);
                    }
                }
              )
            });        
          </script>        
    </body>
</html>